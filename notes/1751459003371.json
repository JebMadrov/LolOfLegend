{
  "id": "1751459003371",
  "title": "Nouvelle note",
  "content": "<span style=\"font-size: 14px;\">Sub GenererDocumentWordDepuisExcel()\n    Dim wdApp As Object\n    Dim wdModele As Object\n    Dim wdDoc As Object\n    Dim cheminModele As String\n    Dim dlgOpen As FileDialog\n    Dim cheminEnregistrement As Variant\n    Dim ligne As Long\n    Dim col As Long\n    Dim nomSignet As String\n    Dim derniereColonne As Long\n    Dim numero As String\n    Dim PremLigne As Long\n    Dim DernLigne As Long\n\n\n    \n\n    ' Demander à l'utilisateur de choisir le modèle Word\n    Set dlgOpen = Application.FileDialog(msoFileDialogFilePicker)\n    With dlgOpen\n        .Title = \"Sélectionner le modèle Word\"\n        .Filters.Clear\n        .Filters.Add \"Documents Word\", \"*.docx\"\n        .AllowMultiSelect = False\n        If .Show &lt;&gt; -1 Then\n            MsgBox \"Opération annulée.\", vbExclamation\n            Exit Sub\n        End If\n        cheminModele = .SelectedItems(1)\n    End With\n    \n    ' --- Sélectionner le dossier d'enregistrement ---\n    With Application.FileDialog(msoFileDialogFolderPicker)\n        .Title = \"Sélectionner un dossier pour enregistrer les documents Word\"\n        If .Show &lt;&gt; -1 Then\n            MsgBox \"Opération annulée.\", vbExclamation\n            Exit Sub\n        End If\n        dossierEnregistrement = .SelectedItems(1)\n    End With\n\n    ' Ouvrir Word\n    Set wdApp = CreateObject(\"Word.Application\")\n    wdApp.Visible = False\n\n    ' Ouvrir le modèle Word en lecture seule\n    Set wdModele = wdApp.Documents.Open(cheminModele, ReadOnly:=True)\n    \n\n    derniereColonne = Cells(1, Columns.Count).End(xlToLeft).Column\n    \n    \n       \n    For ligne = PremLigne To DernLigne\n    ' Créer un nouveau document basé sur le modèle\n        Set wdDoc = wdApp.Documents.Add(Template:=cheminModele, NewTemplate:=False, DocumentType:=0)\n        numero = FormatEn4Chiffres(Cells(ligne, trouverIndex(\"Numéro Fives Nordon\")).Value)\n        \n        ' Nom du fichier\n        cheminEnregistrement = dossierEnregistrement &amp; \"\\\" &amp; _\n            \"ENM-CT6321-\" &amp; _\n            Cells(ligne, trouverIndex(\"Asset / Zone\")).Value &amp; \"-\" &amp; _\n            Cells(ligne, trouverIndex(\"PBS / System / Building\")).Value &amp; \"-\" &amp; _\n            Cells(ligne, trouverIndex(\"Type de document\")).Value &amp; \"-\" &amp; _\n            numero &amp; \"-\" &amp; _\n            Cells(ligne, trouverIndex(\"Révision\")).Value &amp; \".docx\"\n    \n        With wdDoc\n            If .Bookmarks.Exists(\"Asset___Zone\") Then .Bookmarks(\"Asset___Zone\").Range.Text = Cells(ligne, trouverIndex(\"Asset / Zone\")).Value\n            If .Bookmarks.Exists(\"Important_pour_la_s_ret_\") Then .Bookmarks(\"Important_pour_la_s_ret_\").Range.Text = Cells(ligne, trouverIndex(\"Important pour la sûreté\")).Value\n            If .Bookmarks.Exists(\"Niveau_de_protection\") Then .Bookmarks(\"Niveau_de_protection\").Range.Text = Cells(ligne, trouverIndex(\"Niveau de protection\")).Value\n            If .Bookmarks.Exists(\"Numero_Document\") Then .Bookmarks(\"Numero_Document\").Range.Text = numero\n            If .Bookmarks.Exists(\"Numero_Document2\") Then .Bookmarks(\"Numero_Document2\").Range.Text = numero\n            If .Bookmarks.Exists(\"PBS___System___Building\") Then .Bookmarks(\"PBS___System___Building\").Range.Text = Cells(ligne, trouverIndex(\"PBS / System / Building\")).Value\n            If .Bookmarks.Exists(\"PBS___System___Building2\") Then .Bookmarks(\"PBS___System___Building2\").Range.Text = Cells(ligne, trouverIndex(\"PBS / System / Building\")).Value\n            If .Bookmarks.Exists(\"Savoir_faire\") Then .Bookmarks(\"Savoir_faire\").Range.Text = Cells(ligne, trouverIndex(\"Savoir faire\")).Value\n            If .Bookmarks.Exists(\"Titre_du_document\") Then .Bookmarks(\"Titre_du_document\").Range.Text = Cells(ligne, trouverIndex(\"Titre du document\")).Value\n            If .Bookmarks.Exists(\"Type_de_document\") Then .Bookmarks(\"Type_de_document\").Range.Text = Cells(ligne, trouverIndex(\"Type de document\")).Value\n            If .Bookmarks.Exists(\"Type_de_document2\") Then .Bookmarks(\"Type_de_document2\").Range.Text = Cells(ligne, trouverIndex(\"Type de document\")).Value\n            If .Bookmarks.Exists(\"Type_Propri_t__intellectuelle\") Then .Bookmarks(\"Type_Propri_t__intellectuelle\").Range.Text = Cells(ligne, trouverIndex(\"Type Propriété intellectuelle\")).Value\n        End With\n    \n    \n        \n    \n        ' Enregistrement du document Word\n        wdDoc.SaveAs2 Filename:=cheminEnregistrement, FileFormat:=16 ' 16 = wdFormatDocumentDefault\n        wdDoc.Close SaveChanges:=False\n    Next ligne\n        \n        \n    ' Nettoyage\n    ' Fermer le modèle sans modification\n    wdModele.Close SaveChanges:=False\n    wdApp.Quit\n    Set wdDoc = Nothing\n    Set wdApp = Nothing\nEnd Sub\n\n\nFunction trouverIndex(valeurCherchee As String) As Long\n    Dim col As Long\n    Dim derniereColonne As Long\n    \n    ' Trouver la dernière colonne avec données en ligne 2\n    derniereColonne = Cells(2, Columns.Count).End(xlToLeft).Column\n    \n    For col = 1 To derniereColonne\n        If Trim(CStr(Cells(2, col).Value)) = valeurCherchee Then\n            trouverIndex = col\n            Exit Function\n        End If\n    Next col\n    \n    ' Si non trouvé, renvoyer 0\n    trouverIndex = 0\nEnd Function\n\nFunction FormatEn4Chiffres(nombre As Integer) As String\n    If nombre &lt; 0 Or nombre &gt; 999 Then\n        FormatEn4Chiffres = CStr(nombre)\n    Else\n        FormatEn4Chiffres = Format(nombre, \"0000\")\n    End If\nEnd Function\n\n</span>"
}